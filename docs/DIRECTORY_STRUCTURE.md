# EpiCandi Pipeline Directory Structure

This document describes the complete directory structure generated by the EpiCandi pipeline for *Candida auris* whole genome analysis.

## Overview

The EpiCandi pipeline organizes outputs into logical sections covering data processing, quality control, assembly, evaluation, characterization, and reporting. The structure is designed for easy navigation and supports multiple analysis strategies (Illumina, Nanopore, and hybrid approaches).

## Complete Directory Tree

```
/home/user/epicandi/
│
├── Snakefile_robust                    # Main pipeline workflow file
├── samplesinfo.csv                     # Sample metadata and file paths
├── config.yaml                         # Pipeline configuration
│
├── envs/                               # Conda environment specifications
│   ├── epicandi.yml                    # Main analysis environment
│   ├── epicandi_phylo.yml              # Phylogenetic analysis tools
│   ├── epicandi_chroquetas.yml         # Resistance analysis (ChroQueTas)
│   └── epicandi_clair3.yml             # Variant calling environment
│
├── scripts/                            # Custom analysis scripts
│   └── analize_resistance.py           # Resistance mutation analysis
│
├── docs/                               # Documentation
│   ├── REFERENCES.md                   # Reference genome documentation
│   ├── NCBI_DOWNLOAD.md               # NCBI tools usage guide
│   ├── USAGE_REFERENCES.md            # Reference system usage
│   └── DIRECTORY_STRUCTURE.md         # This file
│
├── rules/                              # Snakemake rule modules
│   ├── common.smk                      # Common functions and utilities
│   ├── illumina_processing.smk         # Illumina data processing
│   ├── nanopore_processing.smk         # Nanopore data processing
│   ├── qc_validation.smk               # Quality control and validation
│   ├── assembly.smk                    # Assembly strategies
│   ├── assembly_evaluation.smk         # Assembly quality evaluation
│   ├── coverage_analysis.smk           # Coverage and depth analysis
│   ├── references.smk                  # Reference genome management
│   ├── characterization_phylo.smk      # Phylogenetic characterization
│   ├── characterization_resistance.smk # Resistance characterization
│   └── reports.smk                     # Report generation
│
├── resources/                          # Pipeline resources and databases
│   ├── references/                     # Reference genomes
│   │   ├── CladeI_B11205.fasta         # Clade I reference (complete)
│   │   ├── CladeI_B11205.gff3          # Clade I annotations
│   │   ├── CladeI_B11205_info.txt      # Metadata
│   │   ├── CladeI_B11205.fasta.fai     # Samtools index
│   │   ├── CladeI_B11205.fasta.bwt     # BWA index files
│   │   ├── CladeII_B11220.fasta        # Clade II reference (complete)
│   │   ├── CladeIII_B11221.fasta       # Clade III reference
│   │   ├── CladeIV_B11245.fasta        # Clade IV reference (complete)
│   │   ├── CladeV_B18474.fasta         # Clade V reference (complete)
│   │   ├── [all_other_references...]   # Additional clade references
│   │   ├── reference_list.txt          # FastANI reference list
│   │   ├── references_summary.txt      # Summary of all references
│   │   └── .setup_done                 # Setup completion flag
│   │
│   ├── quast/                          # QUAST databases
│   │   └── .setup_done
│   ├── busco/                          # BUSCO lineage datasets
│   │   └── .setup_done
│   ├── checkm2/                        # CheckM2 databases
│   │   └── .setup_done
│   └── mutations/                      # Resistance analysis resources
│       ├── ref_protein.faa             # Reference proteins
│       └── mutations.tsv               # Known resistance mutations
│
├── output/                             # Main pipeline outputs
│   │
│   ├── 00_setup/                       # Setup and staging
│   │   └── staged_data/                # Organized input data
│   │       ├── illumina/               # Organized Illumina reads
│   │       │   ├── {sample}_R1.fastq.gz
│   │       │   └── {sample}_R2.fastq.gz
│   │       └── nanopore/               # Organized Nanopore reads
│   │           └── {sample}.nanopore.fastq.gz
│   │
│   ├── 01_data/                        # Data processing and QC
│   │   │
│   │   ├── 01.1_fastq_raw_qc/          # Raw data quality control
│   │   │   ├── fastqc/                 # FastQC reports (Illumina)
│   │   │   │   ├── {sample}_R1_fastqc.html
│   │   │   │   ├── {sample}_R1_fastqc.zip
│   │   │   │   ├── {sample}_R2_fastqc.html
│   │   │   │   └── {sample}_R2_fastqc.zip
│   │   │   └── nanoplot/               # NanoPlot reports (Nanopore)
│   │   │       └── {sample}/
│   │   │           ├── NanoPlot-report.html
│   │   │           ├── NanoStats.txt
│   │   │           └── [other_plots...]
│   │   │
│   │   ├── 01.2_filtered/              # Filtered reads
│   │   │   ├── fastp/                  # Illumina filtering (fastp)
│   │   │   │   ├── {sample}_fastp_R1.fastq.gz
│   │   │   │   ├── {sample}_fastp_R2.fastq.gz
│   │   │   │   ├── {sample}_fastp.html
│   │   │   │   └── {sample}_fastp.json
│   │   │   └── porechop_filtlong/      # Nanopore filtering
│   │   │       └── {sample}_porechop_filtlong.fastq.gz
│   │   │
│   │   ├── 01.3_fastq_filtered_qc/     # Post-filtering QC
│   │   │   ├── fastqc/                 # FastQC on filtered Illumina
│   │   │   │   ├── {sample}_fastp_R1_fastqc.html
│   │   │   │   ├── {sample}_fastp_R1_fastqc.zip
│   │   │   │   ├── {sample}_fastp_R2_fastqc.html
│   │   │   │   └── {sample}_fastp_R2_fastqc.zip
│   │   │   └── nanoplot/               # NanoPlot on filtered Nanopore
│   │   │       └── {sample}/
│   │   │           ├── NanoPlot-report.html
│   │   │           └── NanoStats.txt
│   │   │
│   │   ├── 01.4_kraken2/               # Taxonomic classification
│   │   │   ├── illumina/               # Kraken2 for Illumina reads
│   │   │   │   ├── {sample}_report.txt
│   │   │   │   └── {sample}_output.txt
│   │   │   └── nanopore/               # Kraken2 for Nanopore reads
│   │   │       ├── {sample}_report.txt
│   │   │       └── {sample}_output.txt
│   │   │
│   │   └── 01.5_samples_pass/          # Sample validation checkpoint
│   │       ├── passed_samples.txt      # Samples passing QC
│   │       ├── hybrid_samples.txt      # Hybrid strategy samples
│   │       ├── short_reads_samples.txt # Illumina-only samples
│   │       ├── long_reads_samples.txt  # Nanopore-only samples
│   │       ├── validation_report.txt   # Detailed validation report
│   │       ├── samples_metrics_table.tsv # QC metrics summary
│   │       └── checkpoint_validation_report.txt
│   │
│   ├── 02_assembly/                    # Assembly and evaluation
│   │   │
│   │   ├── 02.1_draft_assembly/        # Initial assemblies
│   │   │   ├── flye/                   # Flye assemblies (Nanopore/Hybrid)
│   │   │   │   └── {sample}/
│   │   │   │       ├── assembly.fasta
│   │   │   │       ├── assembly_info.txt
│   │   │   │       └── flye.log
│   │   │   └── spades/                 # SPAdes assemblies (Illumina)
│   │   │       └── {sample}/
│   │   │           ├── contigs.fasta
│   │   │           ├── scaffolds.fasta
│   │   │           └── spades.log
│   │   │
│   │   ├── 02.2_polishing/             # Assembly polishing
│   │   │   ├── medaka/                 # Medaka polishing (Nanopore)
│   │   │   │   └── {sample}/
│   │   │   │       └── consensus.fasta
│   │   │   ├── pilon/                  # Pilon polishing (Illumina)
│   │   │   │   └── {sample}/
│   │   │   │       └── {sample}_pilon.fasta
│   │   │   └── pypolca/                # PyPolca polishing (Hybrid)
│   │   │       └── {sample}/
│   │   │           └── {sample}_corrected.fasta
│   │   │
│   │   ├── 02.3_consensus/             # Final assemblies
│   │   │   └── {sample}.fasta          # Final polished assembly
│   │   │
│   │   ├── 02.4_evaluation/            # Assembly quality evaluation
│   │   │   ├── quast/                  # QUAST assembly statistics
│   │   │   │   └── {sample}/
│   │   │   │       ├── report.html
│   │   │   │       ├── report.tsv
│   │   │   │       └── [other_files...]
│   │   │   ├── busco/                  # BUSCO completeness assessment
│   │   │   │   └── {sample}/
│   │   │   │       └── short_summary.txt
│   │   │   ├── checkm2/                # CheckM2 quality assessment
│   │   │   │   └── {sample}/
│   │   │   │       └── quality_report.tsv
│   │   │   ├── quast_summary.tsv       # Consolidated QUAST results
│   │   │   ├── busco_summary.tsv       # Consolidated BUSCO results
│   │   │   ├── checkm2_summary.tsv     # Consolidated CheckM2 results
│   │   │   └── evaluation_summary.txt  # Overall evaluation summary
│   │   │
│   │   ├── 02.6_coverage/              # Coverage analysis
│   │   │   └── {sample}/
│   │   │       ├── {sample}.sorted.bam     # Sorted alignment
│   │   │       ├── {sample}.sorted.bam.bai # BAM index
│   │   │       ├── {sample}.stats.txt      # Alignment statistics
│   │   │       ├── {sample}.coverage.txt   # Coverage summary
│   │   │       ├── {sample}.flagstat.txt   # Alignment flags
│   │   │       └── {sample}.idxstats.txt   # Index statistics
│   │   │
│   │   ├── 02.7_mosdepth/              # Depth analysis
│   │   │   └── {sample}/
│   │   │       ├── {sample}.mosdepth.global.dist.txt # Global depth
│   │   │       ├── {sample}.mosdepth.summary.txt     # Summary
│   │   │       ├── {sample}.per-base.bed.gz          # Per-base depth
│   │   │       └── {sample}.regions.bed.gz           # Regional depth
│   │   │
│   │   ├── hybrid_assemblies_summary.txt      # Hybrid strategy summary
│   │   ├── short_reads_assemblies_summary.txt # Illumina strategy summary
│   │   ├── long_reads_assemblies_summary.txt  # Nanopore strategy summary
│   │   └── all_assemblies_summary.txt         # Complete assembly summary
│   │
│   ├── 03_characterization/            # Genomic characterization
│   │   │
│   │   ├── 03.1_fastani/               # Phylogenetic analysis (FastANI)
│   │   │   └── {sample}/
│   │   │       └── {sample}_fastani.tsv
│   │   │
│   │   ├── 03.2_auriclass/             # Clade classification (AuriClass)
│   │   │   └── {sample}/
│   │   │       └── {sample}_auriclass.tsv
│   │   │
│   │   ├── 03.3_chroquetas/            # Resistance analysis (ChroQueTas)
│   │   │   └── {sample}/
│   │   │       ├── {sample}.ChroQueTaS.AMR_summary.txt
│   │   │       └── {sample}.ChroQueTaS.detailed_report.txt
│   │   │
│   │   ├── 03.4_resistance/            # Custom resistance analysis
│   │   │   └── {sample}/
│   │   │       ├── todas_las_mutaciones.csv        # All detected mutations
│   │   │       ├── mutaciones_de_resistencia.csv   # Known resistance mutations
│   │   │       ├── resistance_analysis_summary.txt # Analysis summary
│   │   │       └── reports/
│   │   │           └── coverage_report.tsv         # Gene coverage report
│   │   │
│   │   ├── fastani_summary.tsv                 # Consolidated FastANI results
│   │   ├── auriclass_summary.tsv               # Consolidated AuriClass results
│   │   ├── chroquetas_summary.tsv              # Consolidated ChroQueTas results
│   │   ├── resistance_analysis_summary.tsv     # Consolidated resistance results
│   │   ├── phylogenetic_characterization_report.txt # Phylogenetic summary
│   │   └── resistance_characterization_report.txt   # Resistance summary
│   │
│   └── 04_report/                      # Final reports and visualization
│       ├── multiqc_report.html         # Comprehensive MultiQC report
│       ├── multiqc_data/               # MultiQC supporting data
│       └── pipeline_dag.png            # Workflow visualization
│
└── output/logs/                        # Execution logs
    │
    ├── 00_setup/                       # Setup and staging logs
    │   ├── staging.log
    │   ├── download_reference_{ref_id}.log
    │   ├── setup_references_complete.log
    │   └── [other_setup_logs...]
    │
    ├── 01_data/                        # Data processing logs
    │   ├── 01.1_fastq_raw_qc/
    │   │   ├── fastqc/
    │   │   │   └── {sample}_R{1,2}_fastqc.log
    │   │   └── nanoplot/
    │   │       └── {sample}_nanoplot.log
    │   ├── 01.2_filtered/
    │   │   ├── fastp/
    │   │   │   └── {sample}_fastp.log
    │   │   └── porechop_filtlong/
    │   │       └── {sample}_porechop_filtlong.log
    │   ├── 01.3_fastq_filtered_qc/
    │   ├── 01.4_kraken2/
    │   │   ├── illumina/
    │   │   │   └── {sample}_kraken2.log
    │   │   └── nanopore/
    │   │       └── {sample}_kraken2.log
    │   └── 01.5_samples_pass/
    │       └── samples_validation.log
    │
    ├── 02_assembly/                    # Assembly and evaluation logs
    │   ├── 02.1_draft_assembly/
    │   │   ├── flye/
    │   │   │   └── {sample}_flye.log
    │   │   └── spades/
    │   │       └── {sample}_spades.log
    │   ├── 02.2_polishing/
    │   │   ├── medaka/
    │   │   │   └── {sample}_medaka.log
    │   │   ├── pilon/
    │   │   │   └── {sample}_pilon.log
    │   │   └── pypolca/
    │   │       └── {sample}_pypolca.log
    │   ├── 02.4_evaluation/
    │   │   ├── quast/
    │   │   │   └── {sample}.log
    │   │   ├── busco/
    │   │   │   └── {sample}.log
    │   │   └── checkm2/
    │   │       └── {sample}.log
    │   ├── 02.6_coverage/
    │   │   ├── {sample}_minimap2.log
    │   │   └── {sample}_samtools.log
    │   └── 02.7_mosdepth/
    │       └── {sample}_mosdepth.log
    │
    ├── 03_characterization/            # Characterization logs
    │   ├── 03.1_fastani/
    │   │   └── {sample}_fastani.log
    │   ├── 03.2_auriclass/
    │   │   └── {sample}_auriclass.log
    │   ├── 03.3_chroquetas/
    │   │   └── {sample}_chroquetas.log
    │   ├── 03.4_resistance/
    │   │   └── {sample}_resistance.log
    │   ├── consolidate_phylo.log
    │   └── consolidate_resistance.log
    │
    └── 04_report/                      # Report generation logs
        └── multiqc.log
```

## Sample Processing Strategies

The pipeline automatically determines the appropriate processing strategy based on available data:

### Strategy 1: Illumina-only
- **Input**: Paired-end Illumina reads
- **Assembly**: SPAdes
- **Polishing**: Pilon
- **Coverage**: BWA-MEM alignment

### Strategy 2: Nanopore-only
- **Input**: Long-read Nanopore data
- **Assembly**: Flye
- **Polishing**: Medaka
- **Coverage**: minimap2 alignment

### Strategy 3: Hybrid (Recommended)
- **Input**: Both Illumina and Nanopore data
- **Assembly**: Flye (structure from Nanopore)
- **Polishing**: Medaka + PyPolca (accuracy from Illumina)
- **Coverage**: minimap2 for Nanopore reads

## Key Output Files

### Assembly Quality
- `output/02_assembly/02.4_evaluation/evaluation_summary.txt` - Complete assembly evaluation
- `output/02_assembly/02.3_consensus/{sample}.fasta` - Final polished assemblies

### Characterization Results
- `output/03_characterization/phylogenetic_characterization_report.txt` - Phylogenetic analysis
- `output/03_characterization/resistance_characterization_report.txt` - Resistance analysis

### Coverage Analysis
- `output/02_assembly/02.6_coverage/{sample}/{sample}.coverage.txt` - Per-contig coverage
- `output/02_assembly/02.7_mosdepth/{sample}/{sample}.mosdepth.summary.txt` - Depth summary

### Comprehensive Reports
- `output/04_report/multiqc_report.html` - Integrated quality and analysis report

## Directory Usage Notes

1. **Temporary Files**: Some intermediate files are marked as temporary and removed after use
2. **Symbolic Links**: Input data is organized using symbolic links to avoid duplication
3. **Logs**: All execution logs are preserved for troubleshooting and reproducibility
4. **Checkpoints**: The pipeline uses checkpoints to dynamically determine which samples proceed to assembly
5. **Resources**: Reference genomes and databases are downloaded once and reused

## Storage Requirements

Approximate storage requirements per sample:
- **Raw data staging**: 2-5 GB per sample
- **Filtered reads**: 1-3 GB per sample
- **Assembly outputs**: 500 MB - 1 GB per sample
- **Coverage analysis**: 200-500 MB per sample
- **Characterization**: 50-100 MB per sample
- **Reports and logs**: 100-200 MB per sample

**Total per sample**: ~5-10 GB depending on data size and strategy

## Reference Genome Collection

The pipeline includes 9 reference genomes representing all 5 C. auris clades:
- **Clade I**: 3 references (including complete genomes)
- **Clade II**: 2 references (including complete genomes)
- **Clade III**: 1 reference
- **Clade IV**: 2 references (including complete genomes)
- **Clade V**: 1 reference (complete genome)

Total reference collection: ~650 MB including indexes